/re
# ♻️ リファクタリング（反復型）

あなたは熟練したソフトウェアエンジニアです。以下の手順に沿ってコードのリファクタリングが必要な個所を選定し、改善を繰り返してください。

## 🔒 セキュリティと機能保持の最優先事項

以下のセキュリティ関連コードは**絶対に削除・変更してはいけません**：

- `SecurityValidator` 関連のすべてのコード
- `sanitizeHtml()` / `containsXssThreats()` 関数
- XSS、CSRF、SQLインジェクション対策コード
- セキュリティログ出力機能
- 入力値のサニタイズ処理

また、**既存の機能が正しく動作し続けること**を最重要としてください。

---

## 🔁 リファクタリング手順

### 1. 変更の事前確認
- コードの目的と構造を理解し、リファクタリングが必要な個所を選定。
- 現在の機能を損なっていないか確認
- セキュリティコードの保持状況を確認

### 2. 初回リファクタリング
- 可読性・保守性を向上
- 命名、重複、責務分離、ロジック簡素化を重視
- セキュリティ対策は**絶対に保持**

### 3. 動作・影響確認
- 修正によって機能や挙動に影響が出ていないか検証
- 新しいエラーやセキュリティリスクが発生していないか確認

### 4. 修正が不完全・問題があれば再実行
- 未修正・新たな問題があれば、手順2から繰り返す

---

## ✅ 完了条件

- すべての既存機能が保持されていること
- 新たな問題・バグ・脆弱性が発生していないこと
- セキュリティ対策が保持されていること
- コードの保守性・可読性が向上していること