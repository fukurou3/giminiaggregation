# Firestore フィールド仕様書
作品投稿機能大規模改修後のFirestoreフィールド定義

## postsコレクション
作品投稿データの完全フィールド仕様

### 基本情報（必須フィールド）
| フィールド名 | 型 | 必須/任意 | 最大文字数 | 説明 |
|-------------|----|---------|-----------|----|
| id | string | 必須 | - | ドキュメントID（自動生成）|
| title | string | 必須 | 19文字 | 作品タイトル |
| url | string | 必須 | - | Gemini共有リンク（バリデーション付き）|
| description | string | 必須 | 500文字 | 作品概要 |
| tagIds | string[] | 必須 | 最大5個、各20文字 | タグID配列 |
| categoryId | string | 必須 | - | カテゴリID |
| thumbnailUrl | string | 任意 | - | サムネイル画像URL（必須／5:3切り抜き）|

### カテゴリ関連
| フィールド名 | 型 | 必須/任意 | 最大文字数 | 説明 |
|-------------|----|---------|-----------|----|
| customCategory | string | 任意 | - | カスタムカテゴリ名（"その他"選択時のみ）|

### 作者情報
| フィールド名 | 型 | 必須/任意 | 最大文字数 | 説明 |
|-------------|----|---------|-----------|----|
| authorId | string | 必須 | - | 作者のFirebase Auth UID |
| authorUsername | string | 必須 | 10文字 | 作者の公開ハンドル名 |

### コンセプト詳細（任意フィールド）
| フィールド名 | 型 | 必須/任意 | 最大文字数 | 説明 |
|-------------|----|---------|-----------|----|
| problemBackground | string | 任意 | 1000文字 | 課題・背景（何を解決したかったか、どうして作ろうと思ったか）|
| useCase | string | 任意 | 1000文字 | 想定シーン・利用者（誰がどんな場面で使うと便利か）|
| uniquePoints | string | 任意 | 1000文字 | 差別化ポイント（他と違う工夫・独自性）|
| futureIdeas | string | 任意 | 1000文字 | 応用・発展アイデア（今後の改良案や応用の方向性）|

### OGPデータ（自動取得）
| フィールド名 | 型 | 必須/任意 | 最大文字数 | 説明 |
|-------------|----|---------|-----------|----|
| ogpTitle | string | 任意 | - | OGPタイトル（URL検証時に自動取得）|
| ogpDescription | string | 任意 | - | OGP説明文（URL検証時に自動取得）|
| ogpImage | string | 任意 | - | OGP画像URL（URL検証時に自動取得）|

### 公開設定
| フィールド名 | 型 | 必須/任意 | デフォルト値 | 説明 |
|-------------|----|---------|-----------|----|
| isPublic | boolean | 必須 | true | 公開状態 |

### システム管理フィールド
| フィールド名 | 型 | 必須/任意 | デフォルト値 | 説明 |
|-------------|----|---------|-----------|----|
| createdAt | Timestamp | 必須 | サーバータイムスタンプ | 作成日時 |
| updatedAt | Timestamp | 必須 | サーバータイムスタンプ | 更新日時 |
| likes | number | 必須 | 0 | いいね数（旧形式、互換性のため保持）|
| favoriteCount | number | 必須 | 0 | お気に入り数（新形式）|
| views | number | 必須 | 0 | 閲覧数 |
| featured | boolean | 必須 | false | おすすめフラグ |

### その他オプション
| フィールド名 | 型 | 必須/任意 | デフォルト値 | 説明 |
|-------------|----|---------|-----------|----|
| acceptInterview | boolean | 任意 | false | 運営取材の受け入れ |

## バリデーションルール

### URL検証
- Geminiの共有リンクのみ許可
- 形式: `https://gemini.google.com/share/xxxxx` または `https://g.co/gemini/share/xxxxx`
- サーバー側でOGPデータ取得と再検証実施

### タグ検証
- 最大5個まで
- 各タグ最大20文字
- 自動生成機能付き

### セキュリティ
- すべてのテキストフィールドはHTMLサニタイズ済み
- Firebase Auth認証必須
- ユーザープロフィール設定完了チェック

### インデックス設定（既存）
- `isPublic` + `views` (desc) + `favoriteCount` (desc)
- `isPublic` + `categoryId` + `createdAt` (desc)
- `isPublic` + `authorId` + `createdAt` (desc)

## 改修内容サマリー
2025年8月時点での大規模改修により以下を追加:
1. コンセプト詳細4フィールド（problemBackground, useCase, uniquePoints, futureIdeas）
2. 運営取材受け入れフラグ（acceptInterview）
3. 各フィールドに適切な文字数制限とバリデーション
4. フロントエンド・バックエンド・型定義の完全対応

既存データの移行は不要（新規項目はすべて任意フィールド）

更新日: 2024年8月9日